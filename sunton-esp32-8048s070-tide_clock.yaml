# Substitution variables used through the codebase
substitutions:
  lightbulb:         "\U000F0335"
  ceiling_light:     "\U000F0769"
  lamp:              "\U000F06B5"
  floor_lamp:        "\U000F08DD"
  string_lights:     "\U000F12BA"
  track_light:       "\U000F0914"
  bulkhead_light:    "\U000F1A2F"
  led_strip:         "\U000F07D6"
  coach_lamp:        "\U000F1020"
  ceiling_fan_light: "\U000F1798"

  icon_font: light40
  text_font: roboto24
  screen_height: '480px'
  screen_width: '800px'
  button_on_color: "burnt_sienna"
  button_off_color: "very_dark_gray"
  icon_on_color: "yellow"
  icon_off_color: "gray"
  label_on_color: "white"
  label_off_color: "gray"
  button_text_color: "white"
  button_height_single: '109px'
  button_height_double: '228px'
  button_width: '150px'
  touchscreen_idle_timeout: "10s"
  touchscreen_daytime_brightness: "100%"
  touchscreen_nighttime_brightness: "50%"
  # Boot screen configuration
  boot_screen_delay: 60s

  # Screen goes to sleep at Mightnight
  screen_sleep_hour: '0'
  screen_sleep_minute: '0'

  # Screen wakes up at 5:30am
  screen_wake_hour: '5'
  screen_wake_minute: '30'

  # Button 2 is a switch (some devcies show up as switches some as lights make sure you use the corresponding file)
  button_2_name: "Button 2"
  button_2_id: couch_lamp
  button_2_icon: $lightbulb
  button_2_device: "switch.athom_smart_plug_v3_50ebc0_switch"

  # Button 3 is an empty object that requires no settings. It just pushes everything down one button

  # Button 4 is dimmable light
  button_4_name: "RGB light"
  button_4_id: rgb_light
  button_4_icon: $string_lights
  button_4_device: light.athom_rgb_light_d93662_rgb_light_strip

esphome:
  name: "tideweather"
  friendly_name: "tideweather"
  comment: "Tide and weather screen"

external_components:
  - source: github://pr#8005
    components: [lvgl]

packages:
  # Generic configuration for ESP32 screens
  core: !include modules/common/core.yaml
  globals: !include modules/common/globals.yaml
  wifi: !include modules/common/wifi.yaml
  colors: !include modules/common/color.yaml
  fonts: !include modules/common/fonts.yaml
  images: !include modules/common/images.yaml

  # Hardware description file
  hardware: !include modules/hardware/sunton-esp32-8048s070.yaml

  # Base settings for LVGL libary
  time: !include modules/lvgl/base/time_homeassistant.yaml
  sensors: !include modules/lvgl/base/sensors_base.yaml
  base: !include modules/lvgl/base/base.yaml
  
  # Weather packages
  weather_icons_200: !include modules/weather/weather_icons_200px.yaml
  weather_icons_100: !include modules/weather/weather_icons_100px.yaml
  weather_forcast_100: !include modules/weather/weather_forecast_100px.yaml

  # Tide forcast packages  
  tides: !include modules/tides/tide_update.yaml  

script:
  - id: time_update
    then:
      - lvgl.label.update:
          id: week_day
          text: !lambda 'return id(system_time).now().strftime("%A");'  # weekday
      - lvgl.label.update:
          id: month_day
          text: !lambda 'return id(system_time).now().strftime("%B %d");'  # Month Day
      - lvgl.label.update:
          id: time_label
          text: !lambda 'return id(system_time).now().strftime("%I:%M %P");' # The format %I:%M %p will display the time in a 12-hour format with "am" or "pm" included              


text_sensor:
  - platform: homeassistant
    entity_id: weather.home
    id: weather_condition
    on_value:
        then:  !include { file: modules/weather/weather_icons_update.yaml, vars: { size: 200, id: weather_condition_icon, input_id: weather_condition  } }

  - platform: homeassistant
    entity_id: weather.home
    attribute: temperature
    id: temperature
    on_value:
        then:
          # Update weather_condition
          - lvgl.label.update:
              id: weather_temperature_today
              text:
                format: "%s°"
                args: [ 'id(temperature).state.c_str()' ]         

  - platform: homeassistant
    entity_id: sensor.home_condition_day_0
    id: condition_today
    on_value:
        then:
          # Update weather_condition
          - lvgl.label.update:
              id: weather_condition_today
              text:
                format: "%s"
                args: [ 'id(condition_today).state.c_str()' ]

# -------------------------------------------------------------------------
# LVGL pages and buttons
# -------------------------------------------------------------------------
lvgl:
  theme: !include { file: modules/lvgl/base/theme.yaml }
  page_wrap: true

# Boot screen
  top_layer: !include { file: modules/lvgl/screens/boot_screen.yaml }

# Main Page
  pages:
      - id: main_page
        width: 100%
        bg_color: White
        widgets:
          - obj:
                width: 320
                height: 480
                x: +2
                pad_all: 0
                layout:
                  pad_column: 0
                  pad_row: 0
                  type: GRID
                  grid_rows: [ 75px, 28px, 75px, 90px, 42px, 98px, 42px, 28px ]                  
                  grid_columns: [FR(25), FR(25), FR(25), FR(25)]
                widgets:
                  - label:
                      text: "Wednesday"
                      id: week_day
                      text_font: roboto72
                      text_align: LEFT
                      grid_cell_row_pos: 0
                      grid_cell_column_pos: 0
                      grid_cell_column_span: 4
                  - label:
                      text: "September 19"
                      id: month_day
                      text_font: roboto24
                      text_align: LEFT
                      grid_cell_row_pos: 1
                      grid_cell_column_pos: 0
                      grid_cell_column_span: 2
                  - label:
                      text: "100°"
                      id: weather_temperature_today
                      text_font: roboto72
                      text_align: LEFT
                      grid_cell_row_pos: 2
                      grid_cell_column_pos: 0
                      grid_cell_column_span: 2
                  - label:
                      width: 200
                      height: 90
                      text: "Generic weather forecast: Weather will be lovely today. Very Sunny. You will love it."
                      id: weather_condition_today
                      long_mode: wrap
                      scrollable: true
                      text_font: roboto20
                      text_align: LEFT
                      grid_cell_row_pos: 3
                      grid_cell_column_pos: 0
                      grid_cell_column_span: 2
                  - image:
                      src: unknown_200
                      id: weather_condition_icon
                      grid_cell_row_pos: 1
                      grid_cell_column_pos: 2
                      grid_cell_column_span: 2
                      grid_cell_row_span: 3
                      
                      
                  - label:
                      text: "Sat"
                      id: forecast_day_0
                      text_font: roboto36
                      grid_cell_row_pos: 4
                      grid_cell_column_pos: 0
                      grid_cell_x_align: CENTER
                  - image:
                      src: unknown_100
                      id: forecast_condition_icon_0
                      grid_cell_row_pos: 5
                      grid_cell_column_pos: 0
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_hi_0
                      text_font: roboto36
                      grid_cell_row_pos: 6
                      grid_cell_column_pos: 0
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_lo_0
                      text_font: roboto24
                      text_color: dodgerblue                      
                      grid_cell_row_pos: 7
                      grid_cell_column_pos: 0
                      grid_cell_x_align: CENTER
                      
                  - label:
                      text: "Sat"
                      id: forecast_day_1
                      text_font: roboto36
                      grid_cell_row_pos: 4
                      grid_cell_column_pos: 1
                      grid_cell_x_align: CENTER
                  - image:
                      src: unknown_100
                      id: forecast_condition_icon_1
                      grid_cell_row_pos: 5
                      grid_cell_column_pos: 1
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_hi_1
                      text_font: roboto36
                      grid_cell_row_pos: 6
                      grid_cell_column_pos: 1
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_lo_1
                      text_font: roboto24
                      text_color: dodgerblue                      
                      grid_cell_row_pos: 7
                      grid_cell_column_pos: 1
                      grid_cell_x_align: CENTER

                  - label:
                      text: "Sat"
                      id: forecast_day_2
                      text_font: roboto36
                      grid_cell_row_pos: 4
                      grid_cell_column_pos: 2
                      grid_cell_x_align: CENTER
                  - image:
                      src: unknown_100
                      id: forecast_condition_icon_2
                      grid_cell_row_pos: 5
                      grid_cell_column_pos: 2
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_hi_2
                      text_font: roboto36
                      grid_cell_row_pos: 6
                      grid_cell_column_pos: 2
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_lo_2
                      text_font: roboto24
                      text_color: dodgerblue                      
                      grid_cell_row_pos: 7
                      grid_cell_column_pos: 2
                      grid_cell_x_align: CENTER

                  - label:
                      text: "Sat"
                      id: forecast_day_3
                      text_font: roboto36
                      grid_cell_row_pos: 4
                      grid_cell_column_pos: 3
                      grid_cell_x_align: CENTER
                  - image:
                      src: unknown_100
                      id: forecast_condition_icon_3
                      grid_cell_row_pos: 5
                      grid_cell_column_pos: 3
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_hi_3
                      text_font: roboto36
                      grid_cell_row_pos: 6
                      grid_cell_column_pos: 3
                      grid_cell_x_align: CENTER
                  - label:
                      text: "100°"
                      id: forecast_temperature_lo_3
                      text_font: roboto24
                      text_color: dodgerblue
                      grid_cell_row_pos: 7
                      grid_cell_column_pos: 3
                      grid_cell_x_align: CENTER          
          - obj:
              height: 480
              width: 480
              bg_opa: TRANSP
              align: TOP_RIGHT
              pad_all: 4
              widgets:
                - meter:
                    height: 100%
                    width: 100%
                    text_font: roboto24
                    outline_width: 1
                    outline_color: black
                    indicator:
                      opa: TRANSP # get rid of that black dot in the center of the meter
                    scales:
                        - range_from: 1
                          range_to: 100
                          angle_range: 360
                          rotation: 270
                          indicators:
                            - image:
                                id: tide_level
                                src: tide_pointer
                                pivot_x: 44
                                pivot_y: 44
                                value: 0
                          ticks:
                            count: 0
                        - range_from: 5
                          range_to: 1
                          angle_range: 120
                          rotation: 300
                          ticks:
                            width: 1
                            count: 5
                            major:
                              label_gap: 25
                              stride: 1
                              width: 2
                              length: 20
                        - range_from: 5
                          range_to: 1
                          angle_range: 120
                          rotation: 120
                          ticks:
                            width: 1
                            count: 5
                            major:
                              label_gap: 25
                              stride: 1
                              width: 2
                              length: 20

                - label:
                    align: center
                    width: 100%
                    text_align: center
                    text_font: roboto24
                    text: "High Tide"
                    y: -215
                - label:
                    id: high_tide_label
                    align: center
                    width: 100%
                    text_align: center
                    text_font: roboto30_bold
                    text: "00:00 am"
                    y: -185
                - label:
                    align: center
                    width: 100%
                    text_align: center
                    text_font: roboto24
                    text: "Low Tide"
                    y: 215
                - label:
                    id: low_tide_label
                    align: center
                    width: 100%
                    text_align: center
                    text_font: roboto30_bold
                    text: "00:00 am"
                    y: 185
          - obj:
              width: 100%
              height: 8%
              bg_opa: TRANSP
              pad_all: 2
              widgets:
                - label:
                    id: time_label
                    text_color: black
                    align: TOP_RIGHT
                    text_align: right
                    text_font: roboto24
                    text: "00:00 am"
